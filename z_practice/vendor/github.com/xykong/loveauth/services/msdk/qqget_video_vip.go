/**
 * Generated by the loveworld utility tools.  DO NOT EDIT!
 * Source: qqget_video_vip
 * User: xy.kong@gmail.com
 * DateTime: 2018-03-27 12:17:25.096255 +0800 CST m=+1.455930678
 */
package msdk

import (
	"github.com/sirupsen/logrus"
	"encoding/json"
	"github.com/xykong/loveauth/errors"
)

//
// 应答: [手Q]获取腾讯视频会员信息
// swagger:response DoQQGetVideoVIPRsp
// noinspection ALL
type DoQQGetVideoVIPRsp struct {
	// in: body
	Body struct {
		//
		// 返回码 0：正确，其它：失败
		//
		Ret int `json:"ret"`
		//
		// ret非0，则表示“错误码，错误提示”，详细注释参见错误码描述
		//
		Msg string `json:"msg"`
		//
		// 年费会员开始时间
		//
		AnnualBeg int `json:"annual_beg"`
		//
		// 年费会员结束时间
		//
		AnnualEnd int `json:"annual_end"`
		//
		// 会员开始时间
		//
		BegTime int `json:"beg_time"`
		//
		// 会员结束时间
		//
		EndTime int `json:"end_time"`
		//
		// 是否年费会员
		//
		IsAnnual int `json:"is_annual"`
		//
		// 会员类型
		//
		ServiceType string `json:"service_type"`
		//
		// 是否为会员；0：非会员，1：会员
		//
		Status int `json:"status"`
		//
		// 会员等级
		//
		VIPLv int `json:"vip_lv"`
		//
		// 会员成长值
		//
		VIPScore int `json:"vip_score"`
	}
}

func QQGetVideoVIP(openId string, token string) (*DoQQGetVideoVIPRsp, error) {

	//noinspection ALL
	module := "/profile/qqget_video_vip"

	platform := QQ

	//noinspection SpellCheckingInspection
	body := map[string]interface{}{
		"appid":       AppId(platform),
		"openid":      openId,
		"accessToken": token,
		"channel_id":  0,
		"timestamp":   0,
		"signature":   "",
	}

	//noinspection SpellCheckingInspection
	resp, err := PostRequestRaw(openId, platform, module, body)

	if err != nil {
		logrus.WithFields(logrus.Fields{
			"error":  err,
			"module": module,
			"body":   body,
		}).Error("QQGetVideoVIP failed.")
		return nil, err
	}

	var data DoQQGetVideoVIPRsp
	if err := json.Unmarshal(resp, &data.Body); err != nil {
		logrus.WithFields(logrus.Fields{
			"error":  err,
			"module": module,
			"body":   body,
		}).Error("QQGetVideoVIP failed.")
		return nil, err
	}

	if data.Body.Ret != 0 {
		return nil, errors.NewCode(errors.Failed)
	}

	return &data, nil
}
